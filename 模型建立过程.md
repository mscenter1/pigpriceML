# 模型建立过程说明

## 变量选取

为建立一个能够更加准确预测生猪价格的模型，我们查阅并参考了生猪价格研究方面的相关文献。文献显示，影响生猪价格的因素可分为两类，分别为**需求因素**和**供给因素**。

- 需求因素意指消费者方面的因素，主要由牛肉、羊肉等互补品和替代品的价格等方面组成；

- 供给因素意指生产者方面的因素，主要由饲料价格、仔猪价格组成。

在文献中，研究者通过多种回归模型，对于不同价格影响因素的组合进行实证研究，探究对于生猪价格影响较显著的因素。研究表明，以玉米和豆粕为主的**饲料价格**、**仔猪价格**、**鸡肉价格**对于生猪价格均有显著影响。部分研究将**疫情**、**购买者消费能力**也纳入模型考虑范围中，但是在不同文献中，这两项因素对于生猪价格的影响结论不一。

因此在构建预测生猪价格模型的时候，结合现有数据可获取程度，选择将**玉米价格**、**豆粕价格**作为主要影响因素；同时研究发现，生猪价格序列具有较强的自相关性，即历史价格数据水平对于预期价格水平具有显著影响，因此将**生猪历史价格**也纳入到模型考虑的范围内。

在建立玉米价格预测模型时，由于影响玉米价格的因素繁多，受到历史玉米价格、多种互补品和替代品及进出口量等因素的影响，因此在本系统预测时，仅以**玉米历史价格**为自变量，进行预期价格的预测。

## 模型选择

### 生猪价格预测模型

对于生猪价格预测，考虑到需要预测未来6个月的生猪价格和玉米价格，我们以过去6个月及7个月的生猪价格、玉米价格和豆粕价格作为自变量，进行模型搭建与预测。

在搭建模型的过程中，我们通过[Azure机器学习平台](https://studio.azureml.net/)，对多个常用的机器学习模型进行了初步筛选，将备选模型范围缩小。

首先，我们分别结合常用的5个机器学习模型，对现有数据集进行预测效果的测试。这5个模型分别为**线性回归模型(Linear Regression)**、**贝叶斯线性回归模型(Bayesian Linear Regression)**、**神经网络模型(Neural Network)**、**随机决策森林模型(Random Decision Forest)**和**提升决策树模型(Boosted Decision Tree)**。

- **线性回归模型**探究已有数据集中自变量与因变量之间的线性关系，并将获取的线性关系用于后续的预测，获得由一组输入数据确定的唯一输出结果。该模型是最基本、也最简单的机器学习模型，

- **贝叶斯线性回归模型**是线性回归模型的衍生品，也会根据历史数据集，获取自变量与因变量之间的关系，并将其用于预测价格。
  
  但是，贝叶斯线性回归模型将不确定性纳入到模型的考虑之中，输出数据并不由输入数据唯一确定。该模型更适合于数据规模小的情况，在进行模型拟合的时候，对于原始数据中的随机波动也具有更强的包容度。

- **神经网络模型**模拟的是生物体内的神经元系统。对于同一组输入数据，该模型多次不同的计算，最后将多次计算的结果整合并输出为该输入数据对应的输出数据，即预测结果。
  
  该模型适用于变量间具有复杂因果关系的情况，以及高度的自学习能力，能够根据由训练集中的自变量获得的模型结果与真实价格进行比对，调整权重的设定，从而获得更加精准的预测结果。

- **随机决策森林模型**将训练集划分为多个小规模的样本集，对于每一个样本集计算得出一个精确度较高的模型，而后对获取到的多个模型进行整合，作为最终使用的模型输出。
  
  当需要将很多因素作为自变量纳入考虑时，此模型可自行筛选出对因变量影响显著的自变量，保留在最终的预测模型中。

- **提升决策树模型**对于同一个训练集进行多次回归，每次回归使用的自变量为上次回归获得的预测结果与真实数据的偏差，使得经过多次计算之后，训练集获得的预测结果趋近于真实数据结果。

将价格数据导入到建立好的模型中后，模型预测的结果如下方两张图所示。其中，实际生猪价格(Real Value)为粉色曲线，其他曲线分别代表不同模型的生猪价格预测数据。由图可看出，线性回归模型、贝叶斯线性回归模型与神经网络模型预测曲线和实际价格曲线更加接近，准确率较高，其中线性回归模型与贝叶斯线性回归模型预测结果相近，考虑到贝叶斯回归模型对于数据规模量较小的情况更加适用，因此后续选择在贝叶斯线性回归模型与神经网络模型中进行选择。

![modelselect1](/image/modelselect1.png )

![modelselect2](/image/modelselect2.png )

基于上述结论，在Python中，我们进行了贝叶斯线性回归模型和神经网络模型两个模型的实现，并比较两种模型预测结果的表现的区别。

首先考察在已有数据集中随机选取数据点作为待预测数据的结果。预测结果如下两图所示，上图为贝叶斯模型预测结果，其中橙色线条表示真实的生猪价格，蓝色线条表示模型的预测结果。对比看出，贝叶斯线性回归模型的预测价格与实际价格更加接近，能更加准确地反映出价格的变化趋势及幅度，而神经网络模型的预测结果与真实数据相差较大。

![Dis_LR_pig](/image/Dis_LR_pig.png)

![Dis_NN_pig](/image/Dis_NN_pig.png)

由于本系统为使用者提供未来6个月内的预测价格数据，因此在考察随机选取数据点预测表现的基础上，仍需考察两模型对于一段连续时间的预测结果与实际价格之间的偏差，其预测结果如下方两张图所示，上图为贝叶斯线性回归模型预测结果。橙色曲线为实际价格数据，蓝色曲线为模型预测结果。

由图可看出，与随机选取数据点进行预测的情况相比，两模型的表现均有所下降。较神经网络模型而言，贝叶斯线性回归的预测结果更加接近实际价格。因此选择贝叶斯线性回归模型进行后续模型的调整，作为最终预测模型使用。

![Con_LR_pig1](/image/Con_LR_pig1.png)

![Con_NN_pig1](/image/Con_NN_pig1.png)

### 玉米价格预测模型

对于玉米价格预测模型，考虑到模型中仅包含历史玉米价格，自变量种类较少，数据集规模较小，因此仅从贝叶斯线性回归模型和神经网络模型中选择最终使用的模型。

与生猪价格模型选择过程相同，首先考察在随机选取数据点的情况下，两模型的表现，结果如下方两张图所示，上图为贝叶斯线性回归模型预测结果。由图可看出，较神经网络模型而言，贝叶斯线性回归模型能更加准确的预测价格的价格变化的趋势和幅度，对于价格预测的取值也更加精确。

![Dis_LR_cor](/image/Dis_LR_cor.png)

![Dis_NN_cor](/image/Dis_NN_cor.png)

在连续时间预测的情况下，较神经网络模型而言，贝叶斯线性回归模型对于玉米价格的变化能够更好的体现。因此最终选择贝叶斯线性回归模型作为预测玉米价格的模型。

![Con_LR_cor1](/image/Con_LR_cor1.png)

![Con_NN_cor1](/image/Con_NN_cor1.png)

## 模型调整

### 生猪价格预测模型

在确定预测模型选择之后，需进行模型变量的调整。

对于生猪价格的预测，当前模型选择的是以过去6、7个月的生猪价格、玉米价格、豆粕价格作为自变量，其中6个月和7个月称为模型的滞后期。选择6个月和7个月作为模型滞后期的原因是为预测未来第6个月的价格数据，但是当对未来第3个月的价格进行预测时，其滞后期可相应缩短到3个月和4个月。

为探究模型滞后期的选取是否对于预测价格的信度和效度产生显著影响，在数据集中选取同一时间段的数据作为测试集，建立新的贝叶斯线性回归模型，新模型以过去第3、4个月的相关价格作为自变量，对未来1-3个月的价格进行预测，预测结果如下两图所示，上面的图为以过去第3和第4个月为自变量的预测结果，其中橙色曲线为实际价格数据，蓝色曲线为模型预测结果。由图可看出，滞后期选取对于模型预测结果的信度和效度并无显著影响。

![pig_34](/image/pig_34.png)

![pig_67](/image/pig_67.png)

考虑到滞后期选取长度越大，可用作训练集的数据量就越少。结合现有数据量的约束，对于未来1-3个月的预测模型，选取滞后期$i\in\{3,4\}$，即使用过去第3个月和第4个月的历史数据进行预测，从而增加可用作训练集的数据记录的数量，提高模型预测表现。对于未来4-6个月的预测模型，选取滞后期$i\in\{6,7\}$。

### 玉米价格预测模型

对于玉米价格的预测，当前选取的模型也为贝叶斯线性回归模型。同理，考察滞后期长度对于预测偏差的影响，结果对比如下方两张图所示，上面的图为以过去第3和第4个月为自变量的预测结果。由图看出，之后其长度的选取对于模型预测并无显著影响。

![corn_34](/image/corn_34.png)

![corn_67](/image/corn_67.png)

由于也存在数据量的约束，因此在进行玉米价格预测的时候，也将其分为2个阶段，分别为未来1-3月及4-6月的预测。
对于未来1-3个月的预测模型，选取滞后期$i\in\{3,4\}$;对于未来4-6个月的预测模型，选取滞后期$i\in\{6,7\}$。

## 参考文献

[1]何蒲明, & 朱信凯. (2011). 玉米价格与生猪价格波动关系的实证研究. 经济问题探索(12).

[2]魏君英, 何蒲明, & 马敬桂. (2013). 仔猪价格与生猪价格波动关系的实证研究. 饲料工业(21).

[3]宁攸凉, & 乔娟. (2010). 中国生猪价格波动的影响与成因探究. 中国畜牧杂志, 46(2), 52-56.

[4]陈迪钦, & 漆雁斌. (2013). 中国生猪价格波动影响因素的实证分析. 湖北农业科学, 52(4), 959-963.
